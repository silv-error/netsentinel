<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              border: "hsl(240 5.9% 90%)",
              input: "hsl(240 5.9% 90%)",
              ring: "hsl(240 5% 64.9%)",
              background: "hsl(0 0% 100%)",
              foreground: "hsl(240 10% 3.9%)",
              primary: {
                DEFAULT: "hsl(240 5.9% 10%)",
                foreground: "hsl(0 0% 98%)",
              },
              secondary: {
                DEFAULT: "hsl(240 4.8% 95.9%)",
                foreground: "hsl(240 5.9% 10%)",
              },
              destructive: {
                DEFAULT: "hsl(0 84.2% 60.2%)",
                foreground: "hsl(0 0% 98%)",
              },
              muted: {
                DEFAULT: "hsl(240 4.8% 95.9%)",
                foreground: "hsl(240 3.8% 46.1%)",
              },
              accent: {
                DEFAULT: "hsl(240 4.8% 95.9%)",
                foreground: "hsl(240 5.9% 10%)",
              },
              popover: {
                DEFAULT: "hsl(0 0% 100%)",
                foreground: "hsl(240 10% 3.9%)",
              },
              card: {
                DEFAULT: "hsl(0 0% 100%)",
                foreground: "hsl(240 10% 3.9%)",
              },
              success: {
                DEFAULT: "hsl(142 76% 36%)",
                foreground: "hsl(0 0% 98%)",
              },
              warning: {
                DEFAULT: "hsl(48 96% 53%)",
                foreground: "hsl(240 5.9% 10%)",
              },
              navy: {
                DEFAULT: "hsl(220 40% 12%)",
                foreground: "hsl(0 0% 98%)",
              },
            },
            borderRadius: {
              lg: "0.5rem",
              md: "calc(0.5rem - 2px)",
              sm: "calc(0.5rem - 4px)",
            },
          },
        },
      };
    </script>
    <style type="text/css">
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap");

      body {
        font-family: "Inter", sans-serif;
      }

      .chart-line {
        fill: none;
        stroke: white;
        stroke-width: 2;
      }

      .chart-dot {
        fill: white;
      }

      .chart-grid {
        stroke: rgba(255, 255, 255, 0.1);
        stroke-dasharray: 2;
      }
    </style>
  </head>
  <body class="bg-[#09090B] text-white min-h-screen">
    <div class="relative flex flex-col md:flex-row min-h-screen">
      <aside class="w-64 bg-[#09090B] sticky top-0 border-r border-white/10 p-4 h-screen flex flex-col justify-between">
        <div>
          <div class="mb-8">
            <h1 class="text-xl font-bold tracking-tight">NetSentinel</h1>
          </div>
          <nav class="space-y-4">
            <a
              href="{% url 'dashboard' %}"
              class="flex items-center px-3 py-2 text-sm font-bold rounded-md bg-white/10 text-white border"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 mr-2"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
                />
              </svg>
              Dashboard
            </a>
            <!-- <a
                href="{% url 'backlogs' %}"
                class="flex items-center px-3 py-2 text-sm font-bold rounded-md text-white/70 hover:bg-white/10 hover:text-white border border-white/10"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5 mr-2"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                  />
                </svg>
                Backlogs
              </a> -->
            <a
              href="{% url 'stats' %}"
              class="flex items-center px-3 py-2 text-sm font-bold rounded-md text-white/70 hover:bg-white/10 hover:text-white border border-white/10"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 mr-2"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                />
              </svg>
              Stats
            </a>
            <a
              href="{% url 'network' %}"
              class="flex items-center px-3 py-2 text-sm font-bold rounded-md text-white/70 hover:bg-white/10 hover:text-white border border-white/10"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 mr-2"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"
                />
              </svg>
              Networks
            </a>
          </nav>
        </div>
        <div class="pt-4 mt-auto">
          <a
            href="{% url 'user_logout' %}"
            class="flex items-center w-full px-3 py-2 text-sm font-bold rounded-md text-white hover:bg-white/10 border border-white/10 transition-colors"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5 mr-2"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
              />
            </svg>
            Logout
          </a>
        </div>
      </aside>

      <main class="flex-1 p-6 overflow-auto">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div
            class="rounded-lg p-6 flex border border-white/10 flex-col"
            data-aos="fade-up"
            data-aos-delay="600"
            data-aos-offset="600"
          >
            <h2 class="text-lg font-bold text-white mb-4">Network failure</h2>
            <div class="flex-1 flex items-center justify-center">
              <span id="offlineCount" class="text-9xl font-bold">0</span>
            </div>
          </div>

          <div
            class="md:col-span-2 border border-white/10 rounded-lg p-6"
            data-aos="fade-up"
            data-aos-delay="800"
            data-aos-offset="800"
          >
            <h2 class="text-lg font-bold text-white mb-4">BANDWIDTH CONSUMPTION</h2>
            <div class="h-64 relative">
              <svg class="w-full h-full" viewBox="0 0 800 300">
                <line class="chart-grid" x1="0" y1="0" x2="800" y2="0" />
                <line class="chart-grid" x1="0" y1="60" x2="800" y2="60" />
                <line class="chart-grid" x1="0" y1="120" x2="800" y2="120" />
                <line class="chart-grid" x1="0" y1="180" x2="800" y2="180" />
                <line class="chart-grid" x1="0" y1="240" x2="800" y2="240" />
                <line class="chart-grid" x1="0" y1="300" x2="800" y2="300" />

                <line class="chart-grid" x1="100" y1="0" x2="100" y2="300" />
                <line class="chart-grid" x1="200" y1="0" x2="200" y2="300" />
                <line class="chart-grid" x1="300" y1="0" x2="300" y2="300" />
                <line class="chart-grid" x1="400" y1="0" x2="400" y2="300" />
                <line class="chart-grid" x1="500" y1="0" x2="500" y2="300" />
                <line class="chart-grid" x1="600" y1="0" x2="600" y2="300" />
                <line class="chart-grid" x1="700" y1="0" x2="700" y2="300" />

                <path class="chart-line" d="M100,180 L200,60 L300,240 L400,200 L500,260 L600,240 L700,120" />

                <circle class="chart-dot" cx="100" cy="180" r="4" />
                <circle class="chart-dot" cx="200" cy="60" r="4" />
                <circle class="chart-dot" cx="300" cy="240" r="4" />
                <circle class="chart-dot" cx="400" cy="200" r="4" />
                <circle class="chart-dot" cx="500" cy="260" r="4" />
                <circle class="chart-dot" cx="600" cy="240" r="4" />
                <circle class="chart-dot" cx="700" cy="120" r="4" />

                <text x="100" y="320" text-anchor="middle" class="text-xs fill-white/70">Monday</text>
                <text x="200" y="320" text-anchor="middle" class="text-xs fill-white/70">Tuesday</text>
                <text x="300" y="320" text-anchor="middle" class="text-xs fill-white/70">Wednesday</text>
                <text x="400" y="320" text-anchor="middle" class="text-xs fill-white/70">Thursday</text>
                <text x="500" y="320" text-anchor="middle" class="text-xs fill-white/70">Friday</text>
                <text x="600" y="320" text-anchor="middle" class="text-xs fill-white/70">Saturday</text>
                <text x="700" y="320" text-anchor="middle" class="text-xs fill-white/70">Sunday</text>

                <text x="30" y="300" text-anchor="end" class="text-xs fill-white/70">0</text>
                <text x="30" y="240" text-anchor="end" class="text-xs fill-white/70">5</text>
                <text x="30" y="180" text-anchor="end" class="text-xs fill-white/70">10</text>
                <text x="30" y="120" text-anchor="end" class="text-xs fill-white/70">15</text>
                <text x="30" y="60" text-anchor="end" class="text-xs fill-white/70">20</text>
              </svg>
            </div>
          </div>
        </div>

        <div class="mt-6" data-aos="fade-up" data-aos-delay="900">
          <h2 class="text-lg font-bold text-white mb-4">Recent Activities</h2>
          <div class="bg-black/20 rounded-lg overflow-hidden">
            <div id="labs-container" class="max-h-64 overflow-y-auto"></div>
          </div>
        </div>

        <div class="mt-6">
          <h2 class="text-lg font-bold text-white mb-4" data-aos="fade-up" data-aos-delay="1000">FACILITIES STATUS</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="border border-white/10 rounded-lg p-6" data-aos="fade-up" data-aos-delay="1200">
              <div class="text-sm font-bold mb-2">Connected Networks</div>
              <div id="connectedDevices" class="lg:text-4xl text-2xl font-bold mb-4"></div>
              <p class="text-xs text-white/80">This percentage indicates the connectivity status of your networks.</p>
            </div>

            <div class="border border-white/10 rounded-lg p-6" data-aos="fade-up" data-aos-delay="1800">
              <div class="text-sm font-bold mb-2">Network Failed</div>
              <div id="unreachableDevices" class="lg:text-4xl text-2xl font-bold mb-4"></div>
              <p class="text-xs text-white/80">
                Showing the percentage of networks that are not operational and may require immediate attention.
              </p>
            </div>

            <div class="border border-white/10 rounded-lg p-6" data-aos="fade-up" data-aos-delay="1500">
              <div class="text-sm font-bold mb-2 text-white">AVG. BANDWIDTH</div>
              <div id="bandwidthData" class="lg:text-4xl text-2xl font-bold mb-4 text-white">14.67%</div>
              <p class="text-xs text-white/80">
                Track the average bandwidth across your network to ensure optimal performance.
              </p>
            </div>
          </div>
        </div>
      </main>
    </div>
  </body>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    AOS.init();
  </script>
  <script>
    const updateNumber = (value) => {
      const offlineCountElement = document.getElementById("offlineCount");
      offlineCountElement.textContent = value;
    };

    const updateConnectedDevices = (count, total) => {
      const connectedDevicesElement = document.getElementById("connectedDevices");
      const percentage = total > 0 ? ((count / total) * 100).toFixed(2) : 0;
      connectedDevicesElement.textContent = `${percentage}%`;
    };

    const updateUnreachableDevices = (count, total) => {
      const unreachableDevicesElement = document.getElementById("unreachableDevices");
      const percentage = total > 0 ? ((count / total) * 100).toFixed(2) : 0;
      unreachableDevicesElement.textContent = `${percentage}%`;
    };

    (async () => {
      const fetchData = async () => {
        try {
          const response = await fetch("http://127.0.0.1:8000/api/device_data");
          const data = await response.json();
          console.log("Retrieved data:", data);

          const labsContainer = document.getElementById("labs-container");
          labsContainer.innerHTML = "";

          let offlineCount = 0;
          let onlineCount = 0;
          const totalDevices = data.length;

          data.forEach((lab) => {
            if (lab.status === "Offline") {
              offlineCount++;
            } else {
              onlineCount++;
            }

            const labDiv = document.createElement("div");
            labDiv.className =
              lab.status === "Offline"
                ? "p-4 border-b border-white/5 flex justify-between items-center"
                : "bg-transparent p-4 border-b border-white/5 flex justify-between items-center";
            labDiv.innerHTML = `
                        <div>
                            <h3 class="font-medium">${lab.interface}</h3>
                            <p class="text-sm text-white/70">${lab.ip}</p>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-medium ${
                          lab.status === "Offline" ? "bg-gray-400/20" : "bg-success"
                        } text-white">${lab.status}</span>
                    `;
            labsContainer.appendChild(labDiv);
          });

          updateNumber(offlineCount);
          updateConnectedDevices(onlineCount, totalDevices);
          updateUnreachableDevices(offlineCount, totalDevices);
        } catch (error) {
          console.error("Error fetching lab status:", error);
        }
      };

      setInterval(fetchData, 2000);
      fetchData();
    })();

    // * CHART
    function calculateAverage(numbers) {
      if (numbers.length === 0) {
        return 0; // Return 0 or handle the case for an empty list
      }

      const sum = numbers.reduce((accumulator, currentValue) => accumulator + currentValue, 0);
      const average = sum / numbers.length;
      return average;
    }

    const bandwidthDataElement = document.getElementById("bandwidthData");

    const updateBandwidthChart = () => {
      // Generate random bandwidth consumption values for each day of the week
      const bandwidthData = Array.from({ length: 7 }, () => Math.floor(Math.random() * 20));
      const averageBandwidth = calculateAverage(bandwidthData);
      bandwidthDataElement.innerText = `${averageBandwidth.toFixed(2)}%`;

      // Update the SVG path for the line chart
      const pathData = bandwidthData
        .map((value, index) => {
          const x = 100 + index * 100; // X position for each day
          const y = 300 - value * 10; // Y position based on value (scale it)
          return `${index === 0 ? "M" : "L"}${x},${y}`;
        })
        .join(" ");

      // Update the path element
      const pathElement = document.querySelector(".chart-line");
      pathElement.setAttribute("d", pathData);

      // Update the circle positions
      const circleElements = document.querySelectorAll(".chart-dot");
      circleElements.forEach((circle, index) => {
        const x = 100 + index * 100;
        const y = 300 - bandwidthData[index] * 10;
        circle.setAttribute("cx", x);
        circle.setAttribute("cy", y);
      });

      // Update the text labels for the values
      const valueLabels = document.querySelectorAll(".value-label");
      valueLabels.forEach((label, index) => {
        label.textContent = bandwidthData[index];
      });
    };

    // Call the update function every 5 seconds
    setInterval(updateBandwidthChart, 3000);
    // Initial call to populate the chart
    updateBandwidthChart();
  </script>
</html>
